<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>参考《SPA 路由三部曲之核心原理》 | Jay&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/codecat.jpeg">
    <meta name="description" content="贾一倍的个人网站">
    
    <link rel="preload" href="/assets/css/0.styles.35bcedcf.css" as="style"><link rel="preload" href="/assets/js/app.ffeb74c7.js" as="script"><link rel="preload" href="/assets/js/2.8c000b42.js" as="script"><link rel="preload" href="/assets/js/26.1df3f3be.js" as="script"><link rel="prefetch" href="/assets/js/10.d264db59.js"><link rel="prefetch" href="/assets/js/11.0bca9d9a.js"><link rel="prefetch" href="/assets/js/12.4f250ebe.js"><link rel="prefetch" href="/assets/js/13.e66cb20f.js"><link rel="prefetch" href="/assets/js/14.e9740e5f.js"><link rel="prefetch" href="/assets/js/15.77f24c1c.js"><link rel="prefetch" href="/assets/js/16.81145a00.js"><link rel="prefetch" href="/assets/js/17.fecbbc6a.js"><link rel="prefetch" href="/assets/js/18.fa64136a.js"><link rel="prefetch" href="/assets/js/19.0bf73149.js"><link rel="prefetch" href="/assets/js/20.ecf66ee0.js"><link rel="prefetch" href="/assets/js/21.9b56c347.js"><link rel="prefetch" href="/assets/js/22.eba330b8.js"><link rel="prefetch" href="/assets/js/23.cdfc8136.js"><link rel="prefetch" href="/assets/js/24.ecbff0b4.js"><link rel="prefetch" href="/assets/js/25.a765f52f.js"><link rel="prefetch" href="/assets/js/27.6d559f57.js"><link rel="prefetch" href="/assets/js/28.44d0a27d.js"><link rel="prefetch" href="/assets/js/29.0db53b84.js"><link rel="prefetch" href="/assets/js/3.593bb0f3.js"><link rel="prefetch" href="/assets/js/30.ecd999ba.js"><link rel="prefetch" href="/assets/js/31.52600e5f.js"><link rel="prefetch" href="/assets/js/32.32943b2d.js"><link rel="prefetch" href="/assets/js/33.362f4d59.js"><link rel="prefetch" href="/assets/js/34.d0944a8e.js"><link rel="prefetch" href="/assets/js/35.bf1908ad.js"><link rel="prefetch" href="/assets/js/36.2d9be9dc.js"><link rel="prefetch" href="/assets/js/37.3358ac3c.js"><link rel="prefetch" href="/assets/js/38.bae9ecf2.js"><link rel="prefetch" href="/assets/js/39.dfcb747a.js"><link rel="prefetch" href="/assets/js/4.01f7dd6c.js"><link rel="prefetch" href="/assets/js/40.dbf6c454.js"><link rel="prefetch" href="/assets/js/41.a517905d.js"><link rel="prefetch" href="/assets/js/42.e1ae6c7e.js"><link rel="prefetch" href="/assets/js/43.c20697cd.js"><link rel="prefetch" href="/assets/js/44.d5c401fa.js"><link rel="prefetch" href="/assets/js/45.810ad2fb.js"><link rel="prefetch" href="/assets/js/46.cfe99c5e.js"><link rel="prefetch" href="/assets/js/47.32a6c154.js"><link rel="prefetch" href="/assets/js/48.be512d65.js"><link rel="prefetch" href="/assets/js/49.d36d3e6d.js"><link rel="prefetch" href="/assets/js/5.eb23ea04.js"><link rel="prefetch" href="/assets/js/50.4312a7d3.js"><link rel="prefetch" href="/assets/js/51.8db2277f.js"><link rel="prefetch" href="/assets/js/52.0ae05eb4.js"><link rel="prefetch" href="/assets/js/53.e61fc25e.js"><link rel="prefetch" href="/assets/js/54.0f5b381c.js"><link rel="prefetch" href="/assets/js/55.c7beb55c.js"><link rel="prefetch" href="/assets/js/56.97fa88fd.js"><link rel="prefetch" href="/assets/js/57.1e086f28.js"><link rel="prefetch" href="/assets/js/58.97111a0a.js"><link rel="prefetch" href="/assets/js/59.8865259a.js"><link rel="prefetch" href="/assets/js/6.516e3b20.js"><link rel="prefetch" href="/assets/js/60.0541b26f.js"><link rel="prefetch" href="/assets/js/61.624fbdfa.js"><link rel="prefetch" href="/assets/js/62.e71bbf4a.js"><link rel="prefetch" href="/assets/js/63.ad78749d.js"><link rel="prefetch" href="/assets/js/64.931d419d.js"><link rel="prefetch" href="/assets/js/65.b46213b4.js"><link rel="prefetch" href="/assets/js/66.92c8d024.js"><link rel="prefetch" href="/assets/js/67.c63280ef.js"><link rel="prefetch" href="/assets/js/68.16012c5b.js"><link rel="prefetch" href="/assets/js/69.b4a8ea96.js"><link rel="prefetch" href="/assets/js/7.c7625e6b.js"><link rel="prefetch" href="/assets/js/70.c03c3735.js"><link rel="prefetch" href="/assets/js/71.76491655.js"><link rel="prefetch" href="/assets/js/72.ab24e160.js"><link rel="prefetch" href="/assets/js/73.9026af07.js"><link rel="prefetch" href="/assets/js/74.8f925ea4.js"><link rel="prefetch" href="/assets/js/75.8c3d4d08.js"><link rel="prefetch" href="/assets/js/76.2e25789c.js"><link rel="prefetch" href="/assets/js/77.bc9764be.js"><link rel="prefetch" href="/assets/js/78.d13a2495.js"><link rel="prefetch" href="/assets/js/8.80450da7.js"><link rel="prefetch" href="/assets/js/9.dd8d6c7c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.35bcedcf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Jay's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/accumulate/" class="nav-link router-link-active">
  前端基础
</a></div><div class="nav-item"><a href="/stack/" class="nav-link">
  技术栈
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div><div class="nav-item"><a href="/browser/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/network/" class="nav-link">
  计算机网络
</a></div><div class="nav-item"><a href="/optimize/" class="nav-link">
  优化
</a></div><div class="nav-item"><a href="/c++/" class="nav-link">
  c++
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/accumulate/" class="nav-link router-link-active">
  前端基础
</a></div><div class="nav-item"><a href="/stack/" class="nav-link">
  技术栈
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法题库
</a></div><div class="nav-item"><a href="/browser/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/network/" class="nav-link">
  计算机网络
</a></div><div class="nav-item"><a href="/optimize/" class="nav-link">
  优化
</a></div><div class="nav-item"><a href="/c++/" class="nav-link">
  c++
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Accumulate</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/accumulate/" aria-current="page" class="sidebar-link">前端基础</a></li><li><a href="/accumulate/CSS.html" class="sidebar-link">块、行内和行内块</a></li><li><a href="/accumulate/H5离线缓存.html" class="sidebar-link">H5离线缓存（应用程序缓存）Deprecated</a></li><li><a href="/accumulate/JS.html" class="sidebar-link">lodash</a></li><li><a href="/accumulate/JS手写.html" class="sidebar-link">new、call、apply实现</a></li><li><a href="/accumulate/Node.html" class="sidebar-link">Node</a></li><li><a href="/accumulate/Typescript.html" class="sidebar-link">基础类型</a></li><li><a href="/accumulate/URL到页面.html" class="sidebar-link">判断是搜索还是网址</a></li><li><a href="/accumulate/VScode.html" class="sidebar-link">eslint</a></li><li><a href="/accumulate/canvas和svg.html" class="sidebar-link">canvas</a></li><li><a href="/accumulate/electron.html" class="sidebar-link">app</a></li><li><a href="/accumulate/meta标签.html" class="sidebar-link">meta</a></li><li><a href="/accumulate/位运算.html" class="sidebar-link">有符号整数和无符号整数</a></li><li><a href="/accumulate/你不知道的Javascript上.html" class="sidebar-link">1作用域是什么</a></li><li><a href="/accumulate/你不知道的Javascript中.html" class="sidebar-link">1类型</a></li><li><a href="/accumulate/创建对象和对象继承.html" class="sidebar-link">创建对象方式：</a></li><li><a href="/accumulate/初识webpack.html" class="sidebar-link">webpack</a></li><li><a href="/accumulate/前端路由.html" class="active sidebar-link">参考《SPA 路由三部曲之核心原理》</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/accumulate/前端路由.html#参考《spa-路由三部曲之核心原理》" class="sidebar-link">参考《SPA 路由三部曲之核心原理》</a></li><li class="sidebar-sub-header"><a href="/accumulate/前端路由.html#什么是spa" class="sidebar-link">什么是SPA</a></li><li class="sidebar-sub-header"><a href="/accumulate/前端路由.html#前端路由发展历程" class="sidebar-link">前端路由发展历程</a></li><li class="sidebar-sub-header"><a href="/accumulate/前端路由.html#什么是前端路由" class="sidebar-link">什么是前端路由</a></li><li class="sidebar-sub-header"><a href="/accumulate/前端路由.html#hash模式和history模式" class="sidebar-link">hash模式和history模式</a></li><li class="sidebar-sub-header"><a href="/accumulate/前端路由.html#js实现" class="sidebar-link">JS实现</a></li><li class="sidebar-sub-header"><a href="/accumulate/前端路由.html#vue-router" class="sidebar-link">vue-router</a></li></ul></li><li><a href="/accumulate/动画.html" class="sidebar-link">GIF</a></li><li><a href="/accumulate/垃圾回收机制.html" class="sidebar-link">garbage collection</a></li><li><a href="/accumulate/新词.html" class="sidebar-link">这个文档用来记录一些新鲜词汇</a></li><li><a href="/accumulate/模块化.html" class="sidebar-link">commonJS</a></li><li><a href="/accumulate/正则表达式.html" class="sidebar-link">Regular Expression</a></li><li><a href="/accumulate/虚拟列表.html" class="sidebar-link">虚拟列表</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="参考《spa-路由三部曲之核心原理》"><a href="#参考《spa-路由三部曲之核心原理》" class="header-anchor">#</a> 参考《<strong>SPA 路由三部曲之核心原理</strong>》</h2> <h2 id="什么是spa"><a href="#什么是spa" class="header-anchor">#</a> 什么是SPA</h2> <p>单页面应用：就是只加载单个HTML页面，实现URL更改但不向服务端发送请求，只是通过视图切换模拟页面的跳转</p> <h2 id="前端路由发展历程"><a href="#前端路由发展历程" class="header-anchor">#</a> 前端路由发展历程</h2> <ul><li><p>传统页面采用后端渲染，浏览器发送不同的URL请求后，服务器解析不同的URL地址进行后端路由匹配，通过模板引擎拼接形成完整HTML，最后返回完整的HTML页面在浏览器端进行渲染。</p></li> <li><p>服务端渲染的好处是爬虫更容易获取信息，有利于SEO优化，对客户端资源占用更少；坏处是跳转不同的URL都要向服务器发送请求，增加了服务器的压力</p></li> <li><p>ajax 的出现使得可以通过异步请求实现数据交互，页面的局部刷新</p></li> <li><p>借鉴后端模板思想，在客户端通过js及进行动态DOM的拼接，实现页面构建，缓解服务端压力，但不如服务端渲染速度快，也不利于SEO优化</p></li></ul> <p>刚开始的SPA通过js改变html内容，页面本身的url并未发生变化，这就导致两个问题：</p> <ul><li>SPA无法记录用户的操作记录</li> <li>只有一个URL，对SEO不友好</li></ul> <p>为解决上述两个问题。前端路由应运而生。</p> <h2 id="什么是前端路由"><a href="#什么是前端路由" class="header-anchor">#</a> 什么是前端路由</h2> <p>通过改变url但不重新发送请求，通过不同的url匹配不同的视图进行替换，模拟页面跳转</p> <p>为了实现这一目标，需要做到：</p> <ul><li>改变URL但不让浏览器向服务端发送请求</li> <li>监听URL的变化，获取到这一变化从而匹配不同的视图</li></ul> <p>路由描述了URL到页面之间的映射关系，这种映射是单向的，主要分两种：</p> <ul><li>带有hash 的前端路由：URL中有#，即hash值</li> <li>不带hash的前端路由</li></ul> <h2 id="hash模式和history模式"><a href="#hash模式和history模式" class="header-anchor">#</a> hash模式和history模式</h2> <h3 id="hash模式"><a href="#hash模式" class="header-anchor">#</a> hash模式</h3> <p>一个完整的URL包括：协议、域名、端口号、虚拟目录、文件名、参数、锚点，hash值指的就是URL地址中的锚，用来做页面定位</p> <p>hash值的变化不会导致浏览器向服务端发送请求，类似<a>的锚点链接，而hash值的变化可以通过hashchange事件进行监听，</a></p> <ul><li>window.location.hash切换</li> <li>a标签</li> <li>浏览器前进后退history.forward()</li></ul> <h3 id="history模式"><a href="#history模式" class="header-anchor">#</a> history模式</h3> <p>history  HTML5 API</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>history<span class="token punctuation">.</span>length <span class="token comment">// 历史记录对象的长度</span>
history<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 回退到上个历史记录</span>
history<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 前进到下个历史记录</span>
history<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token comment">// 跳转到相应的访问记录</span>
history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加新的状态到历史状态栈</span>
history<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 用新的状态代替当前状态</span>
history<span class="token punctuation">.</span>state  <span class="token comment">// 返回但当前状态对象</span>
window<span class="token punctuation">.</span>onpopstate监听路径切换
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> title<span class="token punctuation">,</span> <span class="token constant">URL</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>state：用于存储该 URL 对应的状态对象</li> <li>title：标题</li> <li>URL：定义新的历史 URL 记录，需要注意，新的 URL 必须与当前 URL 同源，不能跨域</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>history<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> title<span class="token punctuation">,</span> <span class="token constant">URL</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>state：用于存储该 URL 对应的状态对象</li> <li>title：标题</li> <li>URL：定义新的历史 URL 记录，需要注意，新的 URL 必须与当前 URL 同源，不能跨域</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">onpopstate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>调用 history.pushState() 或者 history.replaceState() ，a 标签改变 URL不会触发 popstate 事件。</li> <li>popstate 事件只会在浏览器某些行为下触发, 比如点击后退、前进按钮(或者在JavaScript 中调用 history.back()、history.forward()、history.go()方法)</li> <li>a 标签的锚点也会触发该事件</li></ul> <h3 id="history和hash-的比较"><a href="#history和hash-的比较" class="header-anchor">#</a> history和hash 的比较</h3> <table><thead><tr><th>hash</th> <th>history</th></tr></thead> <tbody><tr><td>兼容性好</td> <td>只兼容有对应history API 的浏览器</td></tr> <tr><td>无需服务器配合处理非单页面的url地址</td> <td>直接访问单页面的url地址会404，因为服务器无法识别这个url，需要在服务端增加一个覆盖所有情况的候选资源，当url匹配不到任何路由，则返回单页面应用的首页，因为其中有路由配置表，所以可以正常访问</td></tr> <tr><td>导致锚点功能失效</td> <td></td></tr> <tr><td>相同的hash值不会触发动作将记录加入到历史栈中</td> <td></td></tr></tbody></table> <h2 id="js实现"><a href="#js实现" class="header-anchor">#</a> JS实现</h2> <ul><li>hash模式</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>Hash 模式路由跳转<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tab<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- 定义路由 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#/home<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> a 标签点击跳转 home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#/about<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> a 标签点击跳转 about<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- JS 动态改变 hash 值，实现跳转 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleToCart<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> JS 动态点击跳转 cart<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>  
        <span class="token comment">&lt;!-- 渲染路由对应的 UI --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>routeViewHash<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>routeView<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">class</span> <span class="token class-name">JSHashRouter</span> <span class="token punctuation">{</span>
            <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">routerview</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>routerView <span class="token operator">=</span> routerview
            <span class="token punctuation">}</span>
            <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// 首次渲染如果不存在 hash 值，那么重定向到 #/,若存在 hash 值，就渲染对应的 UI</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>location<span class="token punctuation">.</span>hash<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    location<span class="token punctuation">.</span>hash<span class="token operator">=</span><span class="token string">&quot;#/&quot;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>routerView<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'当前路由：'</span><span class="token operator">+</span> location<span class="token punctuation">.</span>hash
                <span class="token punctuation">}</span>
                <span class="token comment">// 监听 hash 值改变</span>
                window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'popstate'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>routerView<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'当前路由：'</span><span class="token operator">+</span> location<span class="token punctuation">.</span>hash
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token function">push</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash <span class="token operator">=</span> path
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> routerview <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'routeViewHash'</span><span class="token punctuation">)</span>
            <span class="token comment">// HashRouter 实例化</span>
            <span class="token keyword">let</span> hashRouter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSHashRouter</span><span class="token punctuation">(</span>routerview<span class="token punctuation">)</span>  
            hashRouter<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">// 点击 handleToCart ，JS 动态改变 hash 值</span>
            <span class="token keyword">let</span> handleToCart <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'handleToCart'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            handleToCart<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                hashRouter<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/cart'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>history模式</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tab<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/home<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点击跳转 /home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/about<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点击跳转 /about<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- JS 动态改变 URL 值，实现跳转 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handlePush<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> JS 动态 pushState 跳转 list<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleReplace<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> JS 动态 replaceState 跳转 item<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 渲染路由对应的 UI --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>routeViewHistory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>routeView<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">class</span> <span class="token class-name">JSHistoryRouter</span> <span class="token punctuation">{</span>
            <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">routerview</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>routerView <span class="token operator">=</span> routerview
            <span class="token punctuation">}</span>
            <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">let</span> linkList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'a[href]'</span><span class="token punctuation">)</span>
                linkList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">el</span> <span class="token operator">=&gt;</span> el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 阻止 &lt;a&gt; 默认跳转事件</span>
                    history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> el<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 获取 URL，跳转</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>routerView<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'当前路由：'</span> <span class="token operator">+</span> location<span class="token punctuation">.</span>pathname
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// 监听浏览器行为</span>
                window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'popstate'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>routerView<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'当前路由：'</span> <span class="token operator">+</span> location<span class="token punctuation">.</span>pathname
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token function">push</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>routerView<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'当前路由：'</span> <span class="token operator">+</span> path
            <span class="token punctuation">}</span>
            <span class="token function">replace</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                history<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>routerView<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'当前路由：'</span> <span class="token operator">+</span> path
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> routerview <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'routeViewHistory'</span><span class="token punctuation">)</span>
            <span class="token keyword">let</span> historyRouter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSHistoryRouter</span><span class="token punctuation">(</span>routerview<span class="token punctuation">)</span>  <span class="token comment">// HistoryRouter 实例化</span>
            historyRouter<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">// JS 动态改变 URL 值</span>
            document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'handlePush'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                historyRouter<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/list'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'handleReplace'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                historyRouter<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'/item'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="vue-router"><a href="#vue-router" class="header-anchor">#</a> vue-router</h2> <p>通过 vue.use()，向 VueRouter 对象注入到 Vue 实例，也就是根组件。根组件将 VueRouter 实例一层一层的向下传递，让每个渲染的子组件拥有路由功能</p> <h3 id="两种模式"><a href="#两种模式" class="header-anchor">#</a> 两种模式</h3> <p>在vue-router中，被定义为两种模式，即hash模式和history模式，在 new VueRouter() 时，通过配置路由选项 mode 实现</p> <ul><li>hash模式：vue-router 优先判断浏览器是否支持 pushState，若支持，则通过 pushState 改变 hash 值，进行目标路由匹配，渲染组件，popstate 监听浏览器操作，完成导航功能，若不支持，使用 location.hash 设置 hash 值，hashchange 监听 URL 变化完成路由导航</li> <li>history模式：与 Hash 模式实现导航的思路是一样的。不同的是，vue-router 提供了 fallback 配置，当浏览器不支持 history.pushState 控制路由是否应该回退到 hash 模式。默认值为 true</li></ul> <h3 id="路由守卫"><a href="#路由守卫" class="header-anchor">#</a> 路由守卫</h3> <h3 id="路由信息"><a href="#路由信息" class="header-anchor">#</a> 路由信息</h3></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/accumulate/初识webpack.html" class="prev">
        webpack
      </a></span> <span class="next"><a href="/accumulate/动画.html">
        GIF
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ffeb74c7.js" defer></script><script src="/assets/js/2.8c000b42.js" defer></script><script src="/assets/js/26.1df3f3be.js" defer></script>
  </body>
</html>
